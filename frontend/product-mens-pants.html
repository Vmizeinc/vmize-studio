<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cashmere Cardigan - Vmize Studio</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root { --vmize-purple: #6B4CE6; --vmize-blue: #4CC9F0; --text-primary: #1a1a1a; --text-secondary: #666; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; color: var(--text-primary); background: #fafafa; }
        header { background: white; box-shadow: 0 2px 10px rgba(0,0,0,0.05); padding: 16px 32px; position: sticky; top: 0; z-index: 1000; }
        .header-content { max-width: 1400px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; }
        .logo img { height: 50px; }
        nav { display: flex; gap: 32px; align-items: center; }
        nav a { text-decoration: none; color: var(--text-primary); font-weight: 600; transition: color 0.3s; }
        nav a:hover { color: var(--vmize-purple); }
        .btn-dashboard { padding: 10px 24px; background: linear-gradient(135deg, var(--vmize-purple), var(--vmize-blue)); color: white !important; border-radius: 8px; }
        .back-btn { padding: 10px 20px; background: white; color: var(--vmize-purple); border: 2px solid var(--vmize-purple); border-radius: 8px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: all 0.3s; border: none; }
        .back-btn:hover { background: #f5f3ff; transform: translateX(-4px); }
        .product-container { max-width: 1200px; margin: 40px auto; padding: 0 32px; }
        .product-grid { display: grid; grid-template-columns: 500px 1fr; gap: 60px; background: white; padding: 40px; border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
        .product-image-section { position: relative; }
        .product-main-image { width: 100%; aspect-ratio: 2/3; border-radius: 12px; overflow: hidden; background: #f0f0f0; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .product-main-image img { width: 100%; height: 100%; object-fit: cover; }
        .badge { position: absolute; top: 16px; left: 16px; background: black; color: white; padding: 8px 16px; border-radius: 6px; font-size: 12px; font-weight: 700; }
        .product-info { display: flex; flex-direction: column; }
        .brand { font-size: 18px; font-weight: 700; margin-bottom: 8px; }
        .product-name { font-size: 16px; color: #555; margin-bottom: 16px; line-height: 1.4; }
        .rating { display: flex; align-items: center; gap: 8px; margin-bottom: 20px; }
        .stars { color: #ffa500; font-size: 16px; }
        .price-section { margin-bottom: 24px; }
        .current-price { font-size: 32px; font-weight: 700; color: #c41e3a; }
        .action-buttons { display: flex; flex-direction: column; gap: 12px; }
        .btn { padding: 16px; border: none; border-radius: 8px; font-weight: 700; font-size: 16px; cursor: pointer; transition: all 0.3s; }
        .btn-add-bag { background: #c41e3a; color: white; }
        .btn-tryon { background: linear-gradient(135deg, var(--vmize-purple), var(--vmize-blue)); color: white; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-tryon:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(107, 76, 230, 0.3); }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10000; align-items: center; justify-content: center; }
        .modal.active { display: flex; }
        .modal-content { background: white; border-radius: 16px; padding: 32px; max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
        .modal-title { font-size: 24px; font-weight: 700; }
        .close-btn { background: none; border: none; font-size: 32px; cursor: pointer; color: #999; }
        .upload-section { border: 3px dashed #ddd; border-radius: 12px; padding: 48px; text-align: center; cursor: pointer; transition: all 0.3s; margin-bottom: 24px; }
        .upload-section:hover { border-color: var(--vmize-purple); background: #f5f3ff; }
        .upload-icon { font-size: 64px; margin-bottom: 16px; }
        .loading { text-align: center; padding: 48px; display: none; }
        .loading.active { display: block; }
        .spinner { width: 50px; height: 50px; border: 5px solid #f3f3f3; border-top: 5px solid var(--vmize-purple); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 16px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .result-section { display: none; }
        .result-section.active { display: block; }
        .result-image { width: 100%; border-radius: 12px; margin-bottom: 16px; }
        footer { background: white; padding: 48px 32px; margin-top: 80px; box-shadow: 0 -2px 10px rgba(0,0,0,0.05); }
        .footer-content { max-width: 1400px; margin: 0 auto; }
        .footer-grid { display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; gap: 48px; margin-bottom: 40px; }
        .footer-logo img { height: 50px; margin-bottom: 16px; }
        .footer-desc { color: var(--text-secondary); line-height: 1.6; max-width: 300px; }
        .footer-links h4 { margin-bottom: 16px; font-weight: 700; }
        .footer-links a { display: block; color: var(--text-secondary); text-decoration: none; margin-bottom: 12px; transition: color 0.3s; }
        .footer-links a:hover { color: var(--vmize-purple); }
        .footer-bottom { border-top: 1px solid #e0e0e0; padding-top: 24px; display: flex; justify-content: space-between; align-items: center; }
        .footer-bottom p { color: #999; font-size: 14px; }
        @media (max-width: 900px) { .product-grid { grid-template-columns: 1fr; } nav { display: none; } }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <a href="index.html" class="logo">
                                <span id="logoImg">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 512 512">
                                        <image href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIACAIAAAB7GkOtAAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABA... (base64 continues) ..." width="50" height="50"/>
                                    </svg>
                                </span>
            </a>
            <nav>
                <a href="index.html">Home</a>
                <a href="about.html">About</a>
                <a href="demo-public.html">Demo</a>
                <a href="integration.html">Integration</a>
                <a href="login.html" class="btn-dashboard">Dashboard</a>
            </nav>
            <button class="back-btn" onclick="goBack()">
                <span>‚Üê</span> Back
            </button>
        </div>
    </header>

    <div class="product-container">
        <div class="product-grid">
            <div class="product-image-section">
                <div class="product-main-image">
                    <img src="https://images.unsplash.com/photo-1434389677669-e08b4cac3105?w=600&h=900&fit=crop&q=80" alt="Cashmere Cardigan" id="productImage">
                </div>
                <div class="badge">NEW</div>
            </div>

            <div class="product-info">
                <div class="brand">Premium Womenswear</div>
                <div class="product-name">Cashmere Cardigan - Luxurious feel, button-front design</div>
                <div class="rating">
                    <span class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ</span>
                    <span style="color: #666; font-size: 14px;">4.5 (187 reviews)</span>
                </div>
                <div class="price-section">
                    <span class="current-price">$129.99</span>
                    <span style="color: #c41e3a; font-size: 14px; margin-left: 8px;">(50% off)</span>
                </div>
                <div class="action-buttons">
                    <button class="btn btn-add-bag">Add To Bag</button>
                    <button class="btn btn-tryon" onclick="openTryOnModal()">
                        <span>üëñ</span>
                        <span>Virtual Try-On</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="tryonModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Virtual Try-On</div>
                <button class="close-btn" onclick="closeTryOnModal()">√ó</button>
            </div>
            <div class="upload-section" id="uploadSection" onclick="document.getElementById('photoUpload').click()">
                <div class="upload-icon">üì∏</div>
                <div style="font-size: 18px; font-weight: 600; margin-bottom: 8px;">Upload Your Photo</div>
                <div style="font-size: 14px; color: #666;">Click to upload or drag and drop</div>
                <input type="file" id="photoUpload" accept="image/*" onchange="handleUpload(event)" style="display: none;">
            </div>
            <div class="loading" id="loadingSection">
                <div class="spinner"></div>
                <p style="color: #666;">Processing your try-on... This may take 10-30 seconds</p>
            </div>
            <div class="result-section" id="resultSection">
                <img src="" alt="Try-on result" class="result-image" id="resultImage">
                <button class="btn btn-add-bag" style="width: 100%;">Add To Bag</button>
            </div>
        </div>
    </div>

    <footer>
        <div class="footer-content">
            <div class="footer-grid">
                <div>
                    <div class="footer-logo">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 512 512">
                                                    <image href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIACAIAAAB7GkOtAAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABA... (base64 continues) ..." width="50" height="50"/>
                                                </svg>
                    </div>
                    <p class="footer-desc">
                        AI-powered virtual try-on technology that helps e-commerce brands increase conversion and reduce returns.
                    </p>
                </div>
                <div class="footer-links">
                    <h4>Product</h4>
                    <a href="demo-public.html">Demo</a>
                    <a href="integration.html">Integration</a>
                    <a href="dashboard-complete.html">Dashboard</a>
                </div>
                <div class="footer-links">
                    <h4>Company</h4>
                    <a href="#">Contact</a>
                </div>
                <div class="footer-links">
                    <h4>Support</h4>
                    <a href="#">Help Center</a>
                    <a href="#">Documentation</a>
                </div>
            </div>
            <div class="footer-bottom">
                <p>¬© 2025 Vmize Studio. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
                // Highlight active nav link
                document.addEventListener('DOMContentLoaded', function() {
                    const links = document.querySelectorAll('nav a');
                    const path = window.location.pathname.split('/').pop();
                    links.forEach(link => {
                        const href = link.getAttribute('href');
                        if (href && href !== '#' && href !== '' && (href === path || (href !== '#' && path === '' && href === 'index.html'))) {
                            link.classList.add('active');
                        }
                    });
                });
        const BACKEND_URL = 'https://your-backend.railway.app';
        const DEMO_API_KEY = 'vmize_pk_demo_test_1234567890';
        const PRODUCT_CATEGORY = 'tops';
        const PRODUCT_SLUG = 'womens-sweater';

        fetch('/mnt/user-data/uploads/ChatGPT_Image_Dec_26__2025__08_25_13_PM.png')
            .then(response => response.blob())
            .then(blob => {
                const url = URL.createObjectURL(blob);
                document.getElementById('logoImg').src = url;
            })
            .catch(() => console.log('Logo loading failed'));

        function goBack() {
            const sessionHistory = JSON.parse(sessionStorage.getItem('vmize_nav_history') || '[]');
            if (sessionHistory.length > 1) {
                sessionHistory.pop();
                const previousPage = sessionHistory[sessionHistory.length - 1];
                sessionStorage.setItem('vmize_nav_history', JSON.stringify(sessionHistory));
                window.location.href = previousPage;
            } else if (document.referrer && document.referrer.indexOf(window.location.host) !== -1) {
                window.history.back();
            } else {
                window.location.href = 'demo-public.html';
            }
        }

        window.addEventListener('load', () => {
            const sessionHistory = JSON.parse(sessionStorage.getItem('vmize_nav_history') || '[]');
            sessionHistory.push(window.location.pathname);
            if (sessionHistory.length > 10) sessionHistory.shift();
            sessionStorage.setItem('vmize_nav_history', JSON.stringify(sessionHistory));
        });

        function openTryOnModal() {
            document.getElementById('tryonModal').classList.add('active');
            trackEvent('try_on_initiated', {
                product: PRODUCT_SLUG,
                product_name: 'Cashmere Cardigan',
                price: 129.99
            });
        }

        function closeTryOnModal() {
            document.getElementById('tryonModal').classList.remove('active');
            document.getElementById('uploadSection').style.display = 'block';
            document.getElementById('loadingSection').classList.remove('active');
            document.getElementById('resultSection').classList.remove('active');
        }

        async function handleUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            trackEvent('photo_uploaded', {
                product: PRODUCT_SLUG,
                file_size: file.size
            });

            document.getElementById('uploadSection').style.display = 'none';
            document.getElementById('loadingSection').classList.add('active');

            const garmentImageUrl = document.getElementById('productImage').src;
            const modelImageBase64 = await fileToBase64(file);

            try {
                const result = await callVmizeAPI(modelImageBase64, garmentImageUrl);

                document.getElementById('loadingSection').classList.remove('active');
                document.getElementById('resultSection').classList.add('active');
                document.getElementById('resultImage').src = result.output_url || result.output?.image_url || '';

                trackEvent('result_generated', {
                    product: PRODUCT_SLUG,
                    success: true
                });

            } catch (error) {
                console.error('Try-on failed:', error);
                document.getElementById('loadingSection').classList.remove('active');
                document.getElementById('uploadSection').style.display = 'block';
                alert(`Try-on failed: ${error.message}`);

                trackEvent('result_generated', {
                    product: PRODUCT_SLUG,
                    success: false,
                    error: error.message
                });
            }
        }

        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result.split(',')[1]);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        async function callVmizeAPI(modelImageBase64, garmentImageUrl) {
            const startResp = await fetch(`${BACKEND_URL}/api/tryon/generate`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'x-api-key': DEMO_API_KEY
                },
                body: JSON.stringify({
                    model_image: modelImageBase64,
                    garment_image: garmentImageUrl,
                    category: PRODUCT_CATEGORY
                })
            });
            if (!startResp.ok) {
                const err = await startResp.json().catch(() => ({ error: 'Request failed' }));
                throw new Error(err.error || `API request failed (${startResp.status})`);
            }
            const startData = await startResp.json();
            const predictionId = startData.prediction_id || startData.id || startData.predictionId;
            if (!predictionId) {
                throw new Error('No prediction ID returned from API');
            }
            const timeout = 60000;
            const interval = 2000;
            const deadline = Date.now() + timeout;
            while (Date.now() < deadline) {
                await new Promise(r => setTimeout(r, interval));
                const statusResp = await fetch(`${BACKEND_URL}/api/tryon/${predictionId}`, {
                    headers: { 'x-api-key': DEMO_API_KEY }
                });
                if (!statusResp.ok) continue;
                const statusData = await statusResp.json();
                if (statusData.status === 'completed' || statusData.status === 'succeeded') {
                    const outputUrl = statusData.output?.image_url || statusData.output_url || statusData.result?.image_url;
                    return { output_url: outputUrl, output: statusData.output };
                }
                if (statusData.status === 'failed' || statusData.status === 'error') {
                    throw new Error(statusData.error || 'Try-on processing failed');
                }
            }
            throw new Error('Timeout waiting for try-on result (60s)');
        }

        function trackEvent(eventName, properties) {
            fetch(`${BACKEND_URL}/api/analytics/track`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    event: eventName,
                    properties: properties,
                    timestamp: new Date().toISOString(),
                    session_id: getSessionId()
                })
            }).catch(err => console.log('Analytics tracking failed:', err));
            const events = JSON.parse(localStorage.getItem('vmize_events') || '[]');
            events.push({ event: eventName, properties, timestamp: new Date().toISOString() });
            if (events.length > 100) events.shift();
            localStorage.setItem('vmize_events', JSON.stringify(events));
        }

        function getSessionId() {
            let sessionId = sessionStorage.getItem('vmize_session_id');
            if (!sessionId) {
                sessionId = 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                sessionStorage.setItem('vmize_session_id', sessionId);
            }
            return sessionId;
        }

        trackEvent('page_view', {
            page: 'product-womens-sweater',
            product: 'Cashmere Cardigan'
        });
    </script>
</body>
</html>
