<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Vmize Studio</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f5f5f5;
            color: #1a1a1a;
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 260px;
            height: 100vh;
            background: linear-gradient(180deg, #6B4CE6 0%, #5a3dd5 100%);
            padding: 20px;
            overflow-y: auto;
            box-shadow: 4px 0 20px rgba(0,0,0,0.1);
        }

        .logo {
            color: white;
            font-size: 24px;
            font-weight: 800;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(255,255,255,0.2);
        }

        .admin-badge {
            background: rgba(255,255,255,0.2);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
            margin-left: 10px;
        }

        .nav-item {
            padding: 12px 16px;
            color: rgba(255,255,255,0.8);
            cursor: pointer;
            border-radius: 8px;
            margin-bottom: 8px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .nav-item:hover {
            background: rgba(255,255,255,0.1);
            color: white;
        }

        .nav-item.active {
            background: white;
            color: #6B4CE6;
            font-weight: 600;
        }

        .nav-item .icon {
            font-size: 20px;
        }

        /* Main Content */
        .main-content {
            margin-left: 260px;
            padding: 30px;
            min-height: 100vh;
        }

        .header {
            background: white;
            padding: 24px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 32px;
            background: linear-gradient(135deg, #6B4CE6, #4CC9F0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .logout-btn {
            padding: 10px 20px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-label {
            color: #666;
            font-size: 14px;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 36px;
            font-weight: 800;
            background: linear-gradient(135deg, #6B4CE6, #4CC9F0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stat-change {
            font-size: 14px;
            margin-top: 8px;
        }

        .stat-change.positive {
            color: #28a745;
        }

        .stat-change.negative {
            color: #dc3545;
        }

        /* Section */
        .section {
            background: white;
            padding: 24px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 2px solid #f0f0f0;
        }

        .section-title {
            font-size: 20px;
            font-weight: 700;
            color: #1a1a1a;
        }

        /* Filters */
        .filters {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 8px 16px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .filter-btn:hover, .filter-btn.active {
            border-color: #6B4CE6;
            background: #6B4CE6;
            color: white;
        }

        /* Table */
        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            text-align: left;
            padding: 12px;
            background: #f8f9fa;
            font-weight: 600;
            color: #666;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        td {
            padding: 16px 12px;
            border-bottom: 1px solid #f0f0f0;
        }

        tr:hover {
            background: #f8f9fa;
        }

        /* Badge */
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-success {
            background: #d4edda;
            color: #155724;
        }

        .badge-warning {
            background: #fff3cd;
            color: #856404;
        }

        .badge-danger {
            background: #f8d7da;
            color: #721c24;
        }

        .badge-info {
            background: #d1ecf1;
            color: #0c5460;
        }

        /* Progress Bar */
        .progress-bar {
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 4px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #6B4CE6, #4CC9F0);
            transition: width 0.3s;
        }

        .progress-fill.warning {
            background: linear-gradient(90deg, #ffa500, #ff6b00);
        }

        .progress-fill.danger {
            background: linear-gradient(90deg, #dc3545, #c82333);
        }

        /* Action Buttons */
        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            margin-right: 8px;
            transition: all 0.3s;
        }

        .btn-view {
            background: #6B4CE6;
            color: white;
        }

        .btn-delete {
            background: #dc3545;
            color: white;
        }

        .btn-upsell {
            background: #ffa500;
            color: white;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 2px solid #f0f0f0;
        }

        .modal-close {
            font-size: 28px;
            cursor: pointer;
            color: #666;
        }

        /* Image Gallery */
        .image-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 12px;
            margin-top: 20px;
        }

        .gallery-item {
            position: relative;
            aspect-ratio: 1;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
        }

        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .gallery-item .delete-overlay {
            position: absolute;
            top: 0;
            right: 0;
            background: rgba(220, 53, 69, 0.9);
            color: white;
            padding: 4px 8px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
        }

        /* Chart Container */
        .chart-container {
            height: 300px;
            margin-top: 20px;
        }

        /* Alert Box */
        .alert {
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid;
        }

        .alert-warning {
            background: #fff3cd;
            border-color: #ffa500;
            color: #856404;
        }

        .alert-info {
            background: #d1ecf1;
            border-color: #17a2b8;
            color: #0c5460;
        }

        /* Location Map */
        .location-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 12px;
            margin-top: 20px;
        }

        .location-card {
            background: #f8f9fa;
            padding: 16px;
            border-radius: 8px;
            border-left: 4px solid #6B4CE6;
        }

        .location-name {
            font-weight: 600;
            margin-bottom: 8px;
        }

        .location-count {
            color: #666;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="logo">
                        <span id="logoImg">
                            <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 512 512">
                                <image href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIACAIAAAB7GkOtAAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABA... (base64 continues) ..." width="40" height="40"/>
                            </svg>
                        </span>
                        <span class="admin-badge">ADMIN</span>
        </div>

        <div class="nav-item active" onclick="showSection('overview')">
            <span class="icon">üìä</span>
            <span>Overview</span>
        </div>

        <div class="nav-item" onclick="showSection('customers')">
            <span class="icon">üë•</span>
            <span>All Customers</span>
        </div>

        <div class="nav-item" onclick="showSection('upsell')">
            <span class="icon">üí∞</span>
            <span>Upsell Opportunities</span>
        </div>

        <div class="nav-item" onclick="showSection('analytics')">
            <span class="icon">üìà</span>
            <span>Usage Analytics</span>
        </div>

        <div class="nav-item" onclick="showSection('locations')">
            <span class="icon">üåç</span>
            <span>Geographic Data</span>
        </div>

        <div class="nav-item" onclick="showSection('photos')">
            <span class="icon">üì∏</span>
            <span>All Try-On Photos</span>
        </div>

        <div class="nav-item" onclick="showSection('conversions')">
            <span class="icon">üéØ</span>
            <span>Conversion Tracking</span>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Header -->
        <div class="header">
            <div>
                <h1>Admin Dashboard</h1>
                <p style="color: #666; margin-top: 8px;">Manage all Vmize Studio customers</p>
            </div>
            <button class="logout-btn" onclick="openAdminLogoutModal()">üö™ Logout</button>
        </div>

        <!-- Overview Section -->
        <div id="overview-section">
            <!-- Stats Grid -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Total Customers</div>
                    <div class="stat-value" id="totalCustomers">0</div>
                    <div class="stat-change positive">‚Üë +12 this month</div>
                </div>

                <div class="stat-card">
                    <div class="stat-label">Active Subscriptions</div>
                    <div class="stat-value" id="activeSubscriptions">0</div>
                    <div class="stat-change positive">‚Üë 94% active rate</div>
                </div>

                <div class="stat-card">
                    <div class="stat-label">Total Try-Ons</div>
                    <div class="stat-value" id="totalTryons">0</div>
                    <div class="stat-change positive">‚Üë +2,847 this month</div>
                </div>

                <div class="stat-card">
                    <div class="stat-label">Monthly Revenue</div>
                    <div class="stat-value" id="monthlyRevenue">$0</div>
                    <div class="stat-change positive">‚Üë +18% vs last month</div>
                </div>
            </div>

            <!-- Upsell Alerts -->
            <div class="section">
                <div class="section-header">
                    <h2 class="section-title">üéØ Upsell Opportunities</h2>
                    <button class="action-btn btn-view" onclick="showSection('upsell')">View All</button>
                </div>

                <div id="upsellAlerts">
                    <!-- Dynamic upsell alerts -->
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="section">
                <div class="section-header">
                    <h2 class="section-title">üìã Recent Activity</h2>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Customer</th>
                            <th>Activity</th>
                            <th>Time</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="recentActivity">
                        <!-- Dynamic rows -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Customers Section -->
        <div id="customers-section" style="display: none;">
            <div class="section">
                <div class="section-header">
                    <h2 class="section-title">üë• All Customers</h2>
                    <input type="text" placeholder="üîç Search customers..." style="padding: 8px 16px; border: 2px solid #e0e0e0; border-radius: 6px;">
                </div>

                <div class="filters">
                    <button class="filter-btn active" onclick="filterCustomers('all')">All</button>
                    <button class="filter-btn" onclick="filterCustomers('starter')">Starter</button>
                    <button class="filter-btn" onclick="filterCustomers('professional')">Professional</button>
                    <button class="filter-btn" onclick="filterCustomers('business')">Business</button>
                    <button class="filter-btn" onclick="filterCustomers('near-limit')">Near Limit</button>
                </div>

                <table>
                    <thead>
                        <tr>
                            <th>Company</th>
                            <th>Email</th>
                            <th>Plan</th>
                            <th>Usage This Month</th>
                            <th>Location</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="customersTable">
                        <!-- Dynamic rows -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Upsell Section -->
        <div id="upsell-section" style="display: none;">
            <div class="section">
                <div class="section-header">
                    <h2 class="section-title">üí∞ Customers Ready for Upsell</h2>
                </div>

                <div class="alert alert-info">
                    <strong>üí° Upsell Strategy:</strong> These customers are using 80%+ of their monthly limit. Contact them to upgrade before they hit their cap!
                </div>

                <table>
                    <thead>
                        <tr>
                            <th>Company</th>
                            <th>Current Plan</th>
                            <th>Usage</th>
                            <th>% Used</th>
                            <th>Recommended Plan</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="upsellTable">
                        <!-- Dynamic rows -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Analytics Section -->
        <div id="analytics-section" style="display: none;">
            <div class="section">
                <div class="section-header">
                    <h2 class="section-title">üìà Usage Analytics</h2>
                </div>

                <div class="chart-container">
                    <canvas id="usageChart"></canvas>
                </div>
            </div>

            <div class="section">
                <div class="section-header">
                    <h2 class="section-title">üìä Plan Distribution</h2>
                </div>

                <div class="chart-container">
                    <canvas id="planChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Locations Section -->
        <div id="locations-section" style="display: none;">
            <div class="section">
                <div class="section-header">
                    <h2 class="section-title">üåç Customer Locations</h2>
                </div>

                <h3 style="margin-bottom: 16px; color: #666;">Customers by Location</h3>
                <div class="location-grid" id="customerLocations">
                    <!-- Dynamic location cards -->
                </div>
            </div>

            <div class="section">
                <div class="section-header">
                    <h2 class="section-title">üìç End-User Locations (Their Customers)</h2>
                </div>

                <h3 style="margin-bottom: 16px; color: #666;">Try-On Users by Location</h3>
                <div class="location-grid" id="endUserLocations">
                    <!-- Dynamic location cards -->
                </div>
            </div>
        </div>

        <!-- Photos Section -->
        <div id="photos-section" style="display: none;">
            <div class="section">
                <div class="section-header">
                    <h2 class="section-title">üì∏ All Try-On Photos</h2>
                    <div>
                        <select style="padding: 8px; border: 2px solid #e0e0e0; border-radius: 6px; margin-right: 12px;" onchange="filterPhotosByCustomer(this.value)">
                            <option value="all">All Customers</option>
                            <!-- Dynamic options -->
                        </select>
                        <button class="action-btn btn-delete" onclick="deleteAllPhotos()">üóëÔ∏è Delete All</button>
                    </div>
                </div>

                <div class="image-gallery" id="photoGallery">
                    <!-- Dynamic photo grid -->
                </div>
            </div>
        </div>

        <!-- Conversions Section -->
        <div id="conversions-section" style="display: none;">
            <div class="section">
                <div class="section-header">
                    <h2 class="section-title">üéØ Conversion Tracking</h2>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Try-On ‚Üí Add to Cart</div>
                        <div class="stat-value" id="addToCartRate">0%</div>
                        <div class="stat-change positive">‚Üë Industry avg: 25%</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-label">Add to Cart ‚Üí Purchase</div>
                        <div class="stat-value" id="purchaseRate">0%</div>
                        <div class="stat-change positive">‚Üë Industry avg: 35%</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-label">Overall Conversion</div>
                        <div class="stat-value" id="overallConversion">0%</div>
                        <div class="stat-change positive">‚Üë Industry avg: 8.75%</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-label">Total Purchases</div>
                        <div class="stat-value" id="totalPurchases">0</div>
                        <div class="stat-change positive">‚Üë +342 this month</div>
                    </div>
                </div>

                <table>
                    <thead>
                        <tr>
                            <th>Customer</th>
                            <th>Total Try-Ons</th>
                            <th>Added to Cart</th>
                            <th>Purchases</th>
                            <th>Conversion Rate</th>
                            <th>Revenue Impact</th>
                        </tr>
                    </thead>
                    <tbody id="conversionsTable">
                        <!-- Dynamic rows -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Customer Detail Modal -->
    <div class="modal" id="customerModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalCustomerName">Customer Details</h2>
                <span class="modal-close" onclick="closeModal()">&times;</span>
            </div>

            <div id="modalCustomerDetails">
                <!-- Dynamic content -->
            </div>
        </div>
    </div>

    <script>
        // Mock Data (Replace with actual API calls to your backend)
        const mockData = {
            customers: [
                {
                    id: 'cust_001',
                    companyName: 'Fashion Boutique Co',
                    email: 'contact@fashionboutique.com',
                    plan: 'professional',
                    usageThisMonth: 450,
                    limit: 500,
                    location: 'New York, NY',
                    status: 'active',
                    tryons: [],
                    conversions: {
                        tryons: 450,
                        addedToCart: 180,
                        purchases: 65
                    }
                },
                {
                    id: 'cust_002',
                    companyName: 'Urban Threads',
                    email: 'hello@urbanthreads.com',
                    plan: 'starter',
                    usageThisMonth: 92,
                    limit: 100,
                    location: 'Los Angeles, CA',
                    status: 'active',
                    tryons: [],
                    conversions: {
                        tryons: 92,
                        addedToCart: 35,
                        purchases: 12
                    }
                },
                {
                    id: 'cust_003',
                    companyName: 'Elite Fashion Hub',
                    email: 'admin@elitefashion.com',
                    plan: 'business',
                    usageThisMonth: 1850,
                    limit: 2000,
                    location: 'Miami, FL',
                    status: 'active',
                    tryons: [],
                    conversions: {
                        tryons: 1850,
                        addedToCart: 620,
                        purchases: 245
                    }
                }
            ],
            endUserLocations: {
                'New York, NY': 1250,
                'Los Angeles, CA': 890,
                'Chicago, IL': 765,
                'Houston, TX': 654,
                'Miami, FL': 543,
                'San Francisco, CA': 432,
                'Boston, MA': 321,
                'Seattle, WA': 298
            }
        };

        // Initialize Dashboard
        function init() {
            loadOverview();
            loadCustomersTable();
            loadUpsellOpportunities();
            loadLocations();
            loadConversions();
            initCharts();
        }

        // Load Overview
        function loadOverview() {
            document.getElementById('totalCustomers').textContent = mockData.customers.length;
            document.getElementById('activeSubscriptions').textContent = mockData.customers.filter(c => c.status === 'active').length;
            
            const totalTryons = mockData.customers.reduce((sum, c) => sum + c.usageThisMonth, 0);
            document.getElementById('totalTryons').textContent = totalTryons.toLocaleString();
            
            const revenue = mockData.customers.reduce((sum, c) => {
                const prices = { starter: 29, professional: 79, business: 199 };
                return sum + prices[c.plan];
            }, 0);
            document.getElementById('monthlyRevenue').textContent = '$' + revenue.toLocaleString();

            // Load upsell alerts
            loadUpsellAlerts();
            loadRecentActivity();
        }

        // Load Customers Table
        function loadCustomersTable() {
            const tbody = document.getElementById('customersTable');
            tbody.innerHTML = mockData.customers.map(customer => {
                const percentUsed = (customer.usageThisMonth / customer.limit) * 100;
                const progressClass = percentUsed >= 90 ? 'danger' : percentUsed >= 80 ? 'warning' : '';
                const statusBadge = customer.status === 'active' ? 'badge-success' : 'badge-danger';
                
                return `
                    <tr>
                        <td><strong>${customer.companyName}</strong></td>
                        <td>${customer.email}</td>
                        <td><span class="badge badge-info">${customer.plan}</span></td>
                        <td>
                            <div>${customer.usageThisMonth.toLocaleString()} / ${customer.limit.toLocaleString()}</div>
                            <div class="progress-bar">
                                <div class="progress-fill ${progressClass}" style="width: ${percentUsed}%"></div>
                            </div>
                            <small style="color: ${percentUsed >= 90 ? '#dc3545' : percentUsed >= 80 ? '#ffa500' : '#666'}">
                                ${percentUsed.toFixed(1)}% used
                            </small>
                        </td>
                        <td>${customer.location}</td>
                        <td><span class="badge ${statusBadge}">${customer.status}</span></td>
                        <td>
                            <button class="action-btn btn-view" onclick="viewCustomerDetails('${customer.id}')">View</button>
                            ${percentUsed >= 80 ? `<button class="action-btn btn-upsell" onclick="sendUpsellEmail('${customer.id}')">Upsell</button>` : ''}
                            <button class="action-btn btn-delete" onclick="deleteCustomer('${customer.id}')">Delete</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Load Upsell Alerts
        function loadUpsellAlerts() {
            const upsellCustomers = mockData.customers.filter(c => {
                const percentUsed = (c.usageThisMonth / c.limit) * 100;
                return percentUsed >= 80;
            });

            const alertsDiv = document.getElementById('upsellAlerts');
            
            if (upsellCustomers.length === 0) {
                alertsDiv.innerHTML = '<div class="alert alert-info">No customers near their limit right now.</div>';
                return;
            }

            alertsDiv.innerHTML = upsellCustomers.map(customer => {
                const percentUsed = (customer.usageThisMonth / customer.limit) * 100;
                const nextPlan = customer.plan === 'starter' ? 'Professional' : 'Business';
                
                return `
                    <div class="alert alert-warning" style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <strong>${customer.companyName}</strong> is at <strong>${percentUsed.toFixed(1)}%</strong> of their ${customer.plan} plan limit!
                            Recommend upgrading to <strong>${nextPlan}</strong>.
                        </div>
                        <button class="action-btn btn-upsell" onclick="sendUpsellEmail('${customer.id}')">Send Email</button>
                    </div>
                `;
            }).join('');
        }

        // Load Upsell Opportunities Table
        function loadUpsellOpportunities() {
            const tbody = document.getElementById('upsellTable');
            const upsellCustomers = mockData.customers.filter(c => {
                const percentUsed = (c.usageThisMonth / c.limit) * 100;
                return percentUsed >= 80;
            });

            tbody.innerHTML = upsellCustomers.map(customer => {
                const percentUsed = (customer.usageThisMonth / c.limit) * 100;
                const nextPlan = customer.plan === 'starter' ? 'Professional ($79/mo)' : customer.plan === 'professional' ? 'Business ($199/mo)' : 'Enterprise (Custom)';
                
                return `
                    <tr>
                        <td><strong>${customer.companyName}</strong></td>
                        <td><span class="badge badge-info">${customer.plan}</span></td>
                        <td>${customer.usageThisMonth} / ${customer.limit}</td>
                        <td>
                            <strong style="color: ${percentUsed >= 90 ? '#dc3545' : '#ffa500'}">
                                ${percentUsed.toFixed(1)}%
                            </strong>
                        </td>
                        <td>${nextPlan}</td>
                        <td>
                            <button class="action-btn btn-upsell" onclick="sendUpsellEmail('${customer.id}')">üìß Send Email</button>
                            <button class="action-btn btn-view" onclick="callCustomer('${customer.id}')">üìû Call</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Load Locations
        function loadLocations() {
            // Customer locations
            const customerLocDiv = document.getElementById('customerLocations');
            const customerLocs = {};
            mockData.customers.forEach(c => {
                customerLocs[c.location] = (customerLocs[c.location] || 0) + 1;
            });

            customerLocDiv.innerHTML = Object.entries(customerLocs)
                .sort((a, b) => b[1] - a[1])
                .map(([location, count]) => `
                    <div class="location-card">
                        <div class="location-name">üìç ${location}</div>
                        <div class="location-count">${count} customer${count > 1 ? 's' : ''}</div>
                    </div>
                `).join('');

            // End-user locations
            const endUserLocDiv = document.getElementById('endUserLocations');
            endUserLocDiv.innerHTML = Object.entries(mockData.endUserLocations)
                .sort((a, b) => b[1] - a[1])
                .map(([location, count]) => `
                    <div class="location-card">
                        <div class="location-name">üìç ${location}</div>
                        <div class="location-count">${count.toLocaleString()} try-ons</div>
                    </div>
                `).join('');
        }

        // Load Conversions
        function loadConversions() {
            const totalTryons = mockData.customers.reduce((sum, c) => sum + c.conversions.tryons, 0);
            const totalAddedToCart = mockData.customers.reduce((sum, c) => sum + c.conversions.addedToCart, 0);
            const totalPurchases = mockData.customers.reduce((sum, c) => sum + c.conversions.purchases, 0);

            const addToCartRate = ((totalAddedToCart / totalTryons) * 100).toFixed(1);
            const purchaseRate = ((totalPurchases / totalAddedToCart) * 100).toFixed(1);
            const overallConversion = ((totalPurchases / totalTryons) * 100).toFixed(2);

            document.getElementById('addToCartRate').textContent = addToCartRate + '%';
            document.getElementById('purchaseRate').textContent = purchaseRate + '%';
            document.getElementById('overallConversion').textContent = overallConversion + '%';
            document.getElementById('totalPurchases').textContent = totalPurchases.toLocaleString();

            // Load conversions table
            const tbody = document.getElementById('conversionsTable');
            tbody.innerHTML = mockData.customers.map(customer => {
                const convRate = ((customer.conversions.purchases / customer.conversions.tryons) * 100).toFixed(1);
                const avgOrderValue = 89.99; // Mock data
                const revenueImpact = (customer.conversions.purchases * avgOrderValue).toFixed(2);

                return `
                    <tr>
                        <td><strong>${customer.companyName}</strong></td>
                        <td>${customer.conversions.tryons.toLocaleString()}</td>
                        <td>${customer.conversions.addedToCart.toLocaleString()}</td>
                        <td>${customer.conversions.purchases.toLocaleString()}</td>
                        <td><strong>${convRate}%</strong></td>
                        <td><strong>$${revenueImpact}</strong></td>
                    </tr>
                `;
            }).join('');
        }

        // Load Recent Activity
        function loadRecentActivity() {
            const tbody = document.getElementById('recentActivity');
            tbody.innerHTML = `
                <tr>
                    <td><strong>Fashion Boutique Co</strong></td>
                    <td>New try-on generated</td>
                    <td>2 minutes ago</td>
                    <td><span class="badge badge-success">Success</span></td>
                </tr>
                <tr>
                    <td><strong>Urban Threads</strong></td>
                    <td>Approaching usage limit (92/100)</td>
                    <td>15 minutes ago</td>
                    <td><span class="badge badge-warning">Alert</span></td>
                </tr>
                <tr>
                    <td><strong>Elite Fashion Hub</strong></td>
                    <td>Batch try-on completed (50 images)</td>
                    <td>1 hour ago</td>
                    <td><span class="badge badge-success">Success</span></td>
                </tr>
            `;
        }

        // Initialize Charts
        function initCharts() {
            // Usage Chart
            const usageCtx = document.getElementById('usageChart');
            if (usageCtx) {
                new Chart(usageCtx, {
                    type: 'line',
                    data: {
                        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                        datasets: [{
                            label: 'Total Try-Ons',
                            data: [1200, 1900, 3000, 5000, 7500, 8900],
                            borderColor: '#6B4CE6',
                            backgroundColor: 'rgba(107, 76, 230, 0.1)',
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            }

            // Plan Distribution Chart
            const planCtx = document.getElementById('planChart');
            if (planCtx) {
                new Chart(planCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Starter', 'Professional', 'Business'],
                        datasets: [{
                            data: [
                                mockData.customers.filter(c => c.plan === 'starter').length,
                                mockData.customers.filter(c => c.plan === 'professional').length,
                                mockData.customers.filter(c => c.plan === 'business').length
                            ],
                            backgroundColor: ['#6B4CE6', '#4CC9F0', '#1e8e3e']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            }
        }

        // Navigation
        function showSection(section) {
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            event.target.closest('.nav-item').classList.add('active');

            ['overview', 'customers', 'upsell', 'analytics', 'locations', 'photos', 'conversions'].forEach(s => {
                document.getElementById(`${s}-section`).style.display = 'none';
            });

            document.getElementById(`${section}-section`).style.display = 'block';
        }

        // Actions
        function viewCustomerDetails(customerId) {
            const customer = mockData.customers.find(c => c.id === customerId);
            document.getElementById('modalCustomerName').textContent = customer.companyName;
            document.getElementById('modalCustomerDetails').innerHTML = `
                <p><strong>Email:</strong> ${customer.email}</p>
                <p><strong>Plan:</strong> ${customer.plan}</p>
                <p><strong>Usage:</strong> ${customer.usageThisMonth} / ${customer.limit}</p>
                <p><strong>Location:</strong> ${customer.location}</p>
                <p><strong>Status:</strong> ${customer.status}</p>
            `;
            document.getElementById('customerModal').classList.add('show');
        }

        function closeModal() {
            document.getElementById('customerModal').classList.remove('show');
        }

        function sendUpsellEmail(customerId) {
            const customer = mockData.customers.find(c => c.id === customerId);
            alert(`Upsell email sent to ${customer.companyName} (${customer.email})\n\nSubject: You're almost at your limit! Upgrade now.\n\n‚úÖ Email queued for delivery.`);
        }

        function deleteCustomer(customerId) {
            if (confirm('Are you sure you want to delete this customer?')) {
                alert('Customer deleted successfully!');
                loadCustomersTable();
            }
        }

        function filterCustomers(filter) {
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            // Apply filter logic here
        }

        function doAdminLogout() {
            localStorage.removeItem('vmize_admin_token');
            window.location.href = 'admin-login.html';
        }

        function openAdminLogoutModal() {
            let modal = document.getElementById('vmizeAdminLogoutModal');
            if (!modal) {
                modal = document.createElement('div');
                modal.id = 'vmizeAdminLogoutModal';
                modal.style.position = 'fixed';
                modal.style.left = 0;
                modal.style.top = 0;
                modal.style.width = '100%';
                modal.style.height = '100%';
                modal.style.display = 'flex';
                modal.style.alignItems = 'center';
                modal.style.justifyContent = 'center';
                modal.style.background = 'rgba(0,0,0,0.6)';
                modal.style.zIndex = 99999;

                const dialog = document.createElement('div');
                dialog.style.background = 'white';
                dialog.style.padding = '20px';
                dialog.style.borderRadius = '8px';
                dialog.style.maxWidth = '420px';
                dialog.style.width = '90%';
                dialog.style.textAlign = 'center';

                const title = document.createElement('div');
                title.style.fontSize = '18px';
                title.style.fontWeight = '700';
                title.style.marginBottom = '8px';
                title.textContent = 'Sign out of Admin?';

                const desc = document.createElement('div');
                desc.style.color = '#666';
                desc.style.marginBottom = '16px';
                desc.textContent = 'You will be signed out of the admin dashboard.';

                const btnWrap = document.createElement('div');
                btnWrap.style.display = 'flex';
                btnWrap.style.justifyContent = 'center';
                btnWrap.style.gap = '12px';

                const cancel = document.createElement('button');
                cancel.textContent = 'Cancel';
                cancel.style.padding = '10px 16px';
                cancel.style.border = '1px solid #ddd';
                cancel.style.borderRadius = '6px';
                cancel.style.background = '#fff';
                cancel.onclick = function(){ modal.style.display='none'; };

                const confirm = document.createElement('button');
                confirm.textContent = 'Sign Out';
                confirm.style.padding = '10px 16px';
                confirm.style.border = 'none';
                confirm.style.borderRadius = '6px';
                confirm.style.background = '#dc3545';
                confirm.style.color = '#fff';
                confirm.onclick = function() { modal.style.display='none'; doAdminLogout(); };

                btnWrap.appendChild(cancel);
                btnWrap.appendChild(confirm);

                dialog.appendChild(title);
                dialog.appendChild(desc);
                dialog.appendChild(btnWrap);
                modal.appendChild(dialog);
                document.body.appendChild(modal);
            } else {
                modal.style.display = 'flex';
            }
        }

        // Authentication check for admin
        if (!localStorage.getItem('vmize_admin_token')) {
            window.location.href = 'admin-login.html';
        }

        // Initialize on load
        init();
    </script>
</body>
</html>
